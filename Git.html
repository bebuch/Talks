<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="author" content="Benjamin Buch">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style">

    <title>Git</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/theme/black.css">

    <style id="include-fonts">
        @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap');

        :root {
            font-family: 'Noto Sans', 'Noto Color Emoji', sans-serif;
        }
    </style>

    <style id="color-style">
        :root {
            --tt-transition-duration: 0.3s;
            --tt-transition-function: ease;

            color-scheme: light dark;

            --r-overlay-element-bg-color: 240, 240, 240;
            --r-overlay-element-fg-color: 0, 0, 0;

            --tt-text-color: light-dark(#1d1d1b, #e2e2e4);
            --tt-good-color: light-dark(#00f, #0fa);
            --tt-bad-color: light-dark(#ff2200, #ff5200);

            --r-background-color: light-dark(#e2e2e4, #191919);
            --r-main-color: light-dark(#222, #fff);
            --r-heading-color: light-dark(#222, #fff);
            --r-link-color: light-dark(#2a76dd, #42affa);
            --r-link-color-dark: light-dark(#1a53a1, #068de9);
            --r-link-color-hover: light-dark(#6ca0e8, #8dcffc);
            --r-selection-background-color: light-dark(#98bdef, rgba(66, 175, 250, 0.75));
            --r-selection-color: light-dark(#fff, #fff);

            --tt-code-bg: light-dark(#fbebd4, #272822);
            --tt-code-fg: light-dark(#1d1d1b, #ddd);
            --tt-code-title: light-dark(#f06431, white);
            --tt-code-keyword: light-dark(#f92672, #f92672);
            --tt-code-code: light-dark(black, #66d9ef);
            --tt-code-symbol: light-dark(#889b4a, #bf79db);
            --tt-code-string: light-dark(red, #a6e22e);
            --tt-code-comment: light-dark(#855a2c, #a5a18e);

            --tt-coderef-fn: light-dark(#00f, #0af);
            --tt-coderef-var: light-dark(#9c1414, #a63434);
            --tt-coderef-val: light-dark(#d6921e, #f3b854);
        }

        :root.light {
            color-scheme: light;

            --r-overlay-element-bg-color: 0, 0, 0;
            --r-overlay-element-fg-color: 240, 240, 240;
        }

        * {
            transition:
                color var(--tt-transition-duration) var(--tt-transition-function),
                border-color var(--tt-transition-duration) var(--tt-transition-function),
                border-block-color var(--tt-transition-duration) var(--tt-transition-function),
                background-color var(--tt-transition-duration) var(--tt-transition-function),
                column-rule-color var(--tt-transition-duration) var(--tt-transition-function),
                outline-color var(--tt-transition-duration) var(--tt-transition-function),
                text-decoration-color var(--tt-transition-duration) var(--tt-transition-function),
                text-emphasis-color var(--tt-transition-duration) var(--tt-transition-function),
                fill var(--tt-transition-duration) var(--tt-transition-function),
                stroke var(--tt-transition-duration) var(--tt-transition-function);
        }

        body { transition: background-color var(--tt-transition-duration) var(--tt-transition-function) !important; }
    </style>

    <style id="global-style">
        :root {
            --left: 25%;
            --r-heading-margin: 0.35em 0 1em 0;
            --r-main-font: 'Noto Sans', 'Noto Color Emoji', sans-serif;
            --r-heading-font: 'Noto Sans', 'Noto Color Emoji', sans-serif;
            --r-code-font: 'Source Code Pro', monospace;
            --r-heading-text-transform: none;
        }

        html, body {
            height: 100%;
            margin: 0;
        }

        h1, h2, h3, h4 {
            font-variant: small-caps;
        }

        :is(h1, h2, h3, h4) code {
            font-variant: none;
        }

        .row {
            display: flex;
            gap: 3%;
        }
        .left {
            flex-basis: var(--left);
        }
        .right {
            flex-basis: calc(100% - var(--left));
        }
        pre {
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1em;
            overflow-x: auto;
        }
        .no-bullets {
            list-style: none; /* remove default bullets */
            margin: 0;
            padding: 0;
        }
        .no-bullets li::marker {
            content: none;    /* Safari/Firefox: remove default bullets */
        }
        .no-bullets li {
            position: relative;
            padding-left: 3em;
        }
        .no-bullets li::before {
            content: attr(data-emoji);
            position: absolute;
            left: 0em;
            width: 2.5em;
            text-align: right;
            white-space: nowrap;
        }
        .git-read {
            color: var(--tt-good-color);
        }
        .git-write {
            color: var(--tt-bad-color);
        }

        /* Debug */
        .debug .slides {
            outline: 1px var(--tt-text-color) solid;
        }
        .debug ul {
            outline: 1px var(--tt-good-color) solid;
        }
        .debug .no-bullets li::before {
            outline: 1px var(--tt-bad-color) solid;
        }
    </style>

    <script type="module">
        import Reveal from 'https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.esm.js';
        import RevealZoom from 'https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/zoom/zoom.esm.js';
        import RevealNotes from 'https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/notes/notes.esm.js';
        import RevealSearch from 'https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/search/search.esm.js';
        import RevealMarkdown from 'https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/markdown/markdown.esm.js';
        import RevealHighlight from 'https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/highlight/highlight.esm.js';
        import RevealMermaid from 'https://cdn.jsdelivr.net/npm/reveal.js-mermaid-plugin@2.3.0/plugin/mermaid/mermaid.esm.js';

        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll('pre').forEach(pre => {
                const lines = pre.textContent.split('\n');

                // Find the indentation of the first non-empty line
                const firstLineIndentMatch = lines.find(line => line.trim().length > 0)?.match(/^(\s*)/);
                const firstIndent = firstLineIndentMatch ? firstLineIndentMatch[1].length : 0;

                // Remove the indentation
                const adjustedLines = lines.map(line => line.slice(firstIndent));

                pre.textContent = adjustedLines.join('\n').trim();
            });

            document.querySelectorAll("svg.isolate").forEach((svg) => {
                // Copy fonts and color styles into the SVG
                ["include-fonts", "color-style"].forEach(id => {
                    const styleElem = document.getElementById(id);
                    const cloned = styleElem.cloneNode(true);
                    cloned.removeAttribute("id");
                    let defs = svg.querySelector("defs");
                    if (!defs) {
                        defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
                        svg.insertBefore(defs, svg.firstChild);
                    }
                    defs.insertBefore(cloned, defs.firstChild);
                });

                // Serialize SVG to string
                const svgString = new XMLSerializer().serializeToString(svg);

                // Create a Blob and generate a data URL
                const blob = new Blob([svgString], { type: "image/svg+xml" });
                const url = URL.createObjectURL(blob);

                // Create <object> element
                const objectElement = document.createElement("img");
                objectElement.setAttribute("src", url);
                objectElement.setAttribute("width", svg.getAttribute("width") || "100%");
                objectElement.setAttribute("height", svg.getAttribute("height") || "100%");

                // Copy relevant styling or attributes if needed (optional)
                objectElement.className = svg.className;
                objectElement.style.cssText = svg.style.cssText;

                // Replace SVG with object
                svg.parentNode.replaceChild(objectElement, svg);
            });

            // Initialize Reveal with all Plugins
            Reveal.initialize({
                width: 1800,
                height: 1200,
                controls: true,
                slideNumber: true,
                progress: true,
                center: true,
                hash: true,
                plugins: [
                    RevealZoom,
                    RevealNotes,
                    RevealSearch,
                    RevealMarkdown,
                    RevealHighlight,
                    RevealMermaid
                ]
            });

            document.addEventListener('keydown', function(event) {
                if (event.key === 't') {
                    document.documentElement.classList.toggle('light');
                } else if (event.key === 'd') {
                    document.documentElement.classList.toggle('debug');
                }
            });

            Array.from(document.querySelector('.slides').getElementsByClassName('rw-colornote')).forEach(function(element) {
                element.insertAdjacentHTML('beforeend',
                    '<span style="position:absolute;right:0;top:0;font-size:0.5em;"><code class="git-read">read</code><code>/</code><code class="git-write">write</code></span>');
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
</head>
<body>

<div class="reveal">
    <div class="slides">
        <section>
            <h2>Grundkonzepte von Git</h2>
            <div style="display: flex; gap: 1rem;">
                <ul class="no-bullets" style="width: max-content; margin: 0 auto; display: grid; row-gap: 0.5em;">
                    <li data-emoji="🗂️">Repository (Repo)</li>
                    <li data-emoji="📊">Working Directory (WD)</li>
                    <li data-emoji="🎯">Staging Area (SA)</li>
                    <li data-emoji="📦">Commit</li>
                    <li data-emoji="🌿">Branch</li>
                </ul>
                <ul class="no-bullets" style="width: max-content; margin: 0 auto; display: grid; row-gap: 0.5em;">
                    <li data-emoji="🔀">Merge</li>
                    <li data-emoji="⚔️">Conflict</li>
                    <li data-emoji="🌐">Remote</li>
                    <li data-emoji="🔃">Pull &amp; Push</li>
                    <li data-emoji="🏷️">Tag</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>Repository und Working Directory (WD)</h2>
            <div style="display: flex; gap: 1rem;">
                <ul class="no-bullets" style="width: max-content; margin: 0 auto; display: grid; row-gap: 0.5em;">
                    <li data-emoji="📊"><strong>Working Directory:</strong> Dein lokaler Projektordner, in dem du Dateien bearbeitest und speicherst.</li>
                    <li data-emoji="🗂️"><strong><code>.git</code>:</strong> Verstecktes Unterverzeichnis, das alle Versionsdaten und Metadaten enthält – das eigentliche Repo.</li>
                </ul>
                <ul class="no-bullets" style="width: max-content; margin: 0 auto; display: grid; row-gap: 0.5em;">
                    <li data-emoji="🚧"><strong>Trennung:</strong> Das WD gehört nicht zum Repo und zeigt nur den aktuellen Arbeitszustand. Das WD enthält das Repo.</li>
                    <li data-emoji="🔄"><strong>Datenfluss:</strong> Beim Auschecken werden Dateien aus <code>.git</code> ins WD geladen; beim Einchecken vom WD ins <code>.git</code>.</li>
                </ul>
            </div>
        </section>

        <section class="rw-colornote">
            <h2>Repo anlegen und Status zeigen</h2>
            <ul class="no-bullets" style="display: grid; row-gap: 1em;">
                <li data-emoji="🎨"><code class="git-read">git command</code> – lesende Operation<br/><code class="git-write">git command</code> – schreibene Operation</li>
                <li><hr/></li>
                <li data-emoji="🚀"><code class="git-write">git init</code><br/>Erstellt im aktuellen Verzeichnis ein neues Repo (<code>.git</code>)</li>
                <li data-emoji="🧭"><code class="git-read">git status</code><br/>Zeigt aktuellen Zustand des Working Directories und des Repos an</li>
                <li data-emoji="🔍"><code class="git-read">git diff</code><br/>Zeigt Unterschiede zwischen Dateien im Working Directory zur aktuellsten Version im Repo</li>
            </ul>
        </section>

        <section class="rw-colornote">
            <h2><code>git config</code></h2>
            <ul class="no-bullets" style="display: grid; row-gap: 1em;">
                <li data-emoji="⚙️">Liest und schreibt Git-Einstellungen:
                    <ul class="no-bullets" style="display: grid; row-gap: 0.4em; margin-top: 0.4em;">
                        <li data-emoji="🗂️📝"><code class="git-write">git config user.name "Name"</code><br/>Schreibt den Wert lokal im aktuellen Repo</li>
                        <li data-emoji="👤📝"><code class="git-write">git config --global user.name "Name"</code><br/>Schreibt den Wert global im Benutzeraccount</li>
                        <li data-emoji="🖥️📝"><code class="git-write">git config --system user.name "Name"</code><br/>Schreibt den Wert systemweit (eventuell Admin-Rechte benötigt)</li>
                        <li data-emoji="📋"><code class="git-read">git config user.name</code><br/>Liest den aktuellen Wert</li>
                    </ul>
                </li>
                <li data-emoji="📥"><strong>Lesereihenfolge:</strong> Lokal → Global → System (lokale Werte überschreiben globale)</li>
                <li data-emoji="📂"><strong>Speicherorte:</strong>
                    <ul class="no-bullets" style="display: grid; row-gap: 0.4em; margin-top: 0.4em;">
                        <li data-emoji="🗂️📄">Lokal: <code>./.git/config</code></li>
                        <li data-emoji="👤📄">Global: <code>~/.gitconfig</code></li>
                        <li data-emoji="🖥️📄">System: <code>/etc/gitconfig</code> (Installation)</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section>
            <h2>📊⮕🎯⮕🗂️ Git Datenfluss</h2>

            <svg class="isolate" id="" width="1600" height="800" viewBox="0 -15 600 285" xmlns="http://www.w3.org/2000/svg">
                <style>
                    :root {
                        background: transparent;
                        font-size: 16px;
                        color-scheme: light dark;
                        --text-color: light-dark(black, white);
                        --arrow-color: light-dark(black, white);
                        --border-color: light-dark(black, white);
                    }
                    .box {
                        stroke: var(--border-color);
                        stroke-width: 2px;
                    }
                    .label {
                        font-weight: bold;
                        fill: var(--text-color);
                    }
                    .line {
                        stroke: var(--arrow-color);
                        stroke-width: 2px;
                    }
                    .arrow {
                        stroke: var(--arrow-color);
                        stroke-width: 2px;
                        marker-end: url(#arrowhead);
                    }
                </style>
            </svg>

            <script type="module">
                const svg = d3.select("svg");

                const arrowSize = 8;
                svg.append("defs").append("marker")
                    .attr("id", "arrowhead")
                    .attr("class", "arrowhead")
                    .attr("viewBox", `0 ${-arrowSize} ${2* arrowSize} ${2* arrowSize}`)
                    .attr("refX", arrowSize)
                    .attr("refY", 0)
                    .attr("orient", "auto")
                    .attr("markerWidth", arrowSize)
                    .attr("markerHeight", arrowSize)
                    .attr("xoverflow", "visible")
                    .append("svg:path")
                    .attr("d", `M 0,${-arrowSize} L ${2* arrowSize} ,0 L 0,${arrowSize}`)
                    .style("fill", "var(--arrow-color)")
                    .style("mix-blend-mode", "exclusion")
                    .style("stroke", "none");

                const y = 10;
                const height = 260;
                const boxWidth = 170;
                const spacing = 30;

                const colors = {
                    wd: "light-dark(#e1f5fe, #1e0a01)",
                    repo: "light-dark(#c8e6c9, #371936)",
                    sa: "light-dark(#ffe082, #001f7d)",
                    activeColor: "light-dark(#64b5f6, #9b4a09)",
                    inactiveColor: "light-dark(#bbdefb, #442104)",
                };

                // Working Directory
                const wdX = 10;
                const wdY = 30;
                svg.append("rect")
                    .attr("x", wdX)
                    .attr("y", y + wdY)
                    .attr("width", boxWidth)
                    .attr("height", height - wdY - 10)
                    .attr("rx", 6)
                    .attr("class", "box")
                    .style("fill", colors.wd);
                svg.append("text")
                    .attr("x", wdX + boxWidth / 2)
                    .attr("y", wdY + y - 10)
                    .attr("text-anchor", "middle")
                    .attr("class", "label")
                    .text("Working Directory");

                // Repository
                const repoX = wdX + boxWidth + spacing;
                const repoWidth = 2 * boxWidth + 40;
                svg.append("rect")
                    .attr("x", repoX)
                    .attr("y", y)
                    .attr("width", repoWidth)
                    .attr("height", height)
                    .attr("class", "box")
                    .style("fill", colors.repo);
                svg.append("text")
                    .attr("x", repoX + repoWidth / 2)
                    .attr("y", y - 10)
                    .attr("text-anchor", "middle")
                    .attr("class", "label")
                    .text("Repository = .git Directory im WD");

                // Staging Area (left inside Repo, offset for arrow)
                const saX = repoX + 30;
                const saWidth = boxWidth - 20;
                svg.append("rect")
                    .attr("x", saX)
                    .attr("y", y + 30)
                    .attr("width", saWidth)
                    .attr("height", height - 40)
                    .attr("rx", 6)
                    .attr("class", "box")
                    .style("fill", colors.sa);
                svg.append("text")
                    .attr("x", saX + saWidth / 2)
                    .attr("y", y + 22)
                    .attr("text-anchor", "middle")
                    .attr("class", "label")
                    .text("Staging Area");

                // Features (ex-branches) right of SA
                const features = [
                    { name: "NEXT", color: colors.inactiveColor, dasharray: "1" },
                    { name: "HEAD", color: colors.activeColor, dasharray: "0" },
                    { name: "HEAD~1", color: colors.inactiveColor, dasharray: "0" },
                    { name: "HEAD~2", color: colors.inactiveColor, dasharray: "0" }
                ];
                const featureX = saX + saWidth + 40;
                const featureCount = features.length;
                const featureBoxHeight = (height - 40 - ((featureCount - 1) * 10)) / featureCount;

                svg.append("text")
                    .attr("x", featureX + (boxWidth - 30) / 2)
                    .attr("y", y + 22)
                    .attr("text-anchor", "middle")
                    .attr("class", "label")
                    .text("Commits");

                features.forEach((f, i) => {
                    const fy = y + 30 + i * (featureBoxHeight + 10);
                    if (i === 0) {
                        // SA → featureX
                        svg.append("line")
                            .attr("x1", saX + saWidth)
                            .attr("y1", fy + featureBoxHeight / 2)
                            .attr("x2", featureX - arrowSize)
                            .attr("y2", fy + featureBoxHeight / 2)
                            .attr("class", "arrow");
                    } else {
                        // Commit → Next Commit
                        svg.append("line")
                            .attr("x1", featureX + (boxWidth - 30) / 2)
                            .attr("y1", fy - 10)
                            .attr("x2", featureX + (boxWidth - 30) / 2)
                            .attr("y2", fy)
                            .attr("class", "line");
                    }

                    svg.append("rect")
                        .attr("x", featureX)
                        .attr("y", fy)
                        .attr("width", boxWidth - 30)
                        .attr("height", featureBoxHeight)
                        .attr("rx", 6)
                        .attr("class", "box")
                        .style("fill", f.color)
                        .style("stroke-dasharray", f.dasharray);
                    svg.append("text")
                        .attr("x", featureX + (boxWidth - 30) / 2)
                        .attr("y", fy + featureBoxHeight / 2 + 5)
                        .attr("text-anchor", "middle")
                        .text(f.name);
                });

                // WD → SA
                svg.append("line")
                    .attr("x1", wdX + boxWidth)
                    .attr("y1", y + height / 2)
                    .attr("x2", saX - arrowSize)
                    .attr("y2", y + height / 2)
                    .attr("class", "arrow");
            </script>
        </section>

        <section class="rw-colornote">
            <h2>🎯 Staging Area (SA)</h2>
            <div style="display: flex; gap: 1rem;">
                <ul class="no-bullets" style="width: 30%; margin: 0 auto; display: grid; row-gap: 0.5em;">
                    <li data-emoji="🗃️">Zwischenspeicher im Repo für vorgemerkte Änderungen</li>
                    <li data-emoji="⏩">Änderungen wandern von WD in SA</li>
                    <li data-emoji="✅">Dient Auswahl genau der Änderungen, die in die nächste Version einfließen</li>
                    <li data-emoji="📦">Git erzeugt daraus später eine neue Version im Repo</li>
                </ul>
                <ul class="no-bullets" style="width: 70%; margin: 0 auto; display: grid; row-gap: 0.5em;">
                    <li data-emoji="✅"><code class="git-write">git add &lt;file&gt;</code><br>
                        Kopiert Änderungen aus WD in SA.
                    </li>
                    <li data-emoji="✅🎚️"><code class="git-write">git add -p</code><br>
                        Interaktives Hunk-Staging für feinkörnige Kontrolle.
                    </li>
                    <li data-emoji="❌"><code class="git-write">git rm &lt;file&gt;</code><br>
                        Entfernt Datei aus WD und markiert Löschung in SA.
                    </li>
                    <li data-emoji="➡️"><code class="git-write">git mv &lt;old&gt; &lt;new&gt;</code><br>
                        Bennent Dateien in WD um und fügt Umbenennung zu SA hinzu.
                    </li>
                    <li data-emoji="↩️"><code class="git-write">git restore --staged &lt;file&gt;</code><br>
                        Hebt die Vormerkung in der SA auf, das WD bleibt unverändert.
                    </li>
                    <li data-emoji="🔍"><code class="git-read">git diff --staged</code><br>
                        Zeigt die Unterschiede zwischen SA und letzter Version im Repo.
                    </li>
                </ul>
            </div>
        </section>

        <section>
            <h2>Theater</h2>

            <svg class="isolate" id="theater" width="1600" height="800">
                <style>
                    .label {
                        fill: white;
                        text-anchor: middle;
                        dominant-baseline: middle;
                    }
                </style>
            </svg>

            <script type="module">
                const svg = d3.select("#theater");
                const width = +svg.attr("width");
                const height = +svg.attr("height");
                const third = height / 3;
                const fontSize = 64;
                const circleRadius = 24;

                // back stage
                svg.append("rect")
                    .attr("x", 0).attr("y", 0)
                    .attr("width", width).attr("height", third)
                    .attr("fill", "#444");
                svg.append("text")
                    .style("font-size", `${fontSize}px`)
                    .attr("x", width / 2).attr("y", third / 2)
                    .attr("class", "label")
                    .text("Backstage");

                // main stage and side stage
                const stageY = third;
                const stageHeight = third;
                const stageWidth = width * 3 / 4;
                const sideStageWidth = width / 4;

                // main stage
                svg.append("rect")
                    .attr("x", 0).attr("y", stageY)
                    .attr("width", stageWidth).attr("height", stageHeight)
                    .attr("fill", "#777");
                svg.append("text")
                    .style("font-size", `${fontSize}px`)
                    .attr("x", stageWidth / 2).attr("y", stageY + stageHeight / 2)
                    .attr("class", "label")
                    .text("Bühne");

                // side stage
                svg.append("rect")
                    .attr("x", stageWidth).attr("y", stageY)
                    .attr("width", sideStageWidth).attr("height", stageHeight)
                    .attr("fill", "#999");
                svg.append("text")
                    .style("font-size", `${fontSize}px`)
                    .attr("x", stageWidth + sideStageWidth / 2)
                    .attr("y", stageY + stageHeight / 2 - fontSize / 1.5)
                    .attr("class", "label")
                    .text("Seiten-")
                    .clone()
                        .attr("y", stageY + stageHeight / 2 + fontSize / 1.5)
                        .text("Bühne");

                // === place stage emojis ===
                const mainEmojis = ["💃","🐒","🐈‍⬛","🧨","🪄","🌺"];
                const sideEmojis = ["🌳","🌲","🪻","🎊","🌛"];

                // place emojis on main stage
                const msCols = 3, msRows = 2;
                mainEmojis.forEach((emoji, idx) => {
                    const col = idx % msCols;
                    const row = Math.floor(idx / msCols);
                    const xMain = (col + 0.5) * (stageWidth / msCols);
                    const yMain = stageY + (row + 0.5) * (stageHeight / msRows);
                    svg.append("text")
                        .attr("x", xMain)
                        .attr("y", yMain)
                        .attr("text-anchor", "middle")
                        .attr("alignment-baseline", "middle")
                        .style("font-size", `${circleRadius * 2}px`)
                        .text(emoji);
                });

                // place emojis on side stage
                const ssCols = 2, ssRows = 3;
                sideEmojis.forEach((emoji, idx) => {
                    const col = idx % ssCols;
                    const row = Math.floor(idx / ssCols);
                    const xSide = stageWidth + (col + 0.5) * (sideStageWidth / ssCols);
                    const ySide = stageY + (row + 0.5) * (stageHeight / ssRows);
                    svg.append("text")
                        .attr("x", xSide)
                        .attr("y", ySide)
                        .attr("text-anchor", "middle")
                        .attr("alignment-baseline", "middle")
                        .style("font-size", `${circleRadius * 2}px`)
                        .text(emoji);
                });
                // === end stage emojis ===

                // audience area
                const grandstandTop = third * 2;
                const grandstandHeight = third;
                svg.append("rect")
                    .attr("x", 0).attr("y", grandstandTop)
                    .attr("width", width).attr("height", grandstandHeight)
                    .attr("fill", "#ccc");

                const audienceTop = grandstandTop + third / 9;
                const audienceHeight = grandstandHeight - third / 2;

                // seating parameters
                const rows = 3;
                let emojis = [
                    "😅", "😄", "🎃", "😍", "🐻", "🤣", "🐼", "🐰",
                    "😂", "😁", "🐷", "🐶", "😀", "🦁", "😘", "🐭",
                    "😃", "😊", "🙂", "😌", "👽", "🐯", "🤗", "🤩",
                    "😉", "🤔", "🐱", "🙃", "🦊", "🐹", "😆", "🤖",
                    "🐸", "🥰", "🦄", "🐨", "😇", "🐮",
                ];

                for (let r = 0; r < rows; r++) {
                    const seats = 11 + r * 3;
                    const startFrac = r / (rows - 1) * -1/4 + 0.08;
                    const endFrac   = r / (rows - 1) * +1/4 + 3/4 - 0.05;
                    const startX = startFrac * width;
                    const endX   = endFrac   * width;
                    const span   = endX - startX;
                    const spacing = span / (seats - 1);
                    const rowStep = audienceHeight / rows;
                    const centerIndex = (seats - 1) / 2;

                    for (let i = 0; i < seats; i++) {
                        const rel = (i - centerIndex) / centerIndex;
                        const curve = Math.sqrt(Math.max(0, 1 - rel * rel)) * (r + 3) / 3;
                        const y = audienceTop
                            + r * rowStep
                            + curve * rowStep
                            + rowStep / 2;
                        const x = startX + i * spacing;
                        if (x < circleRadius) continue;

                        if (emojis.length > 0) {
                            const emoji = emojis.pop();
                            svg.append("text")
                                .attr("x", x)
                                .attr("y", y)
                                .attr("class", "label")
                                .style("font-size", `${circleRadius * 2}px`)
                                .text(emoji);
                        } else {
                            svg.append("circle")
                                .attr("cx", x)
                                .attr("cy", y)
                                .attr("r", circleRadius)
                                .attr("fill", "#333");
                        }
                    }
                }
            </script>
        </section>

    </div>
</div>
</body>
</html>
